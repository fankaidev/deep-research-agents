# Node-DeepResearch 项目分析

## 项目结构和框架

* **编程语言和框架**：Node-DeepResearch 使用 TypeScript/JavaScript 构建，基于 Node.js 环境运行。项目采用模块化设计，具有明确的类型定义和接口。
* **代码目录结构**：
  * `src/`: 核心代码目录
    * `agent.ts`: 主要的代理实现，负责执行搜索、阅读和推理的核心逻辑
    * `tools/`: 包含各种工具实现，如搜索引擎集成（Brave、DuckDuckGo等）
    * `utils/`: 工具函数，包括URL处理、文本处理等
    * `types.ts`: 定义项目中使用的各种类型和接口
    * `app.ts`: 应用程序主入口
    * `cli.ts`: 命令行接口实现
    * `server.ts`: OpenAI兼容的API服务器实现
  * `__tests__/`: 测试代码

## 交互方式

* **命令行接口**：提供命令行交互，可直接在终端中使用
* **API 服务**：提供与 OpenAI API 兼容的 REST 接口，便于集成到其他应用
* **官方托管服务**：提供在线使用入口 (https://search.jina.ai)
* **库集成**：可作为库集成到其他 Node.js 应用中

## 基本流程

1. **接收查询**：用户提交问题或研究主题
2. **循环处理**：
   * **搜索 (Search)**：使用搜索工具（如Jina Reader）获取相关网页
   * **阅读 (Read)**：访问网页并提取内容
   * **推理 (Reason)**：分析已获得的信息，决定下一步行动或生成答案
3. **生成答案**：基于收集的信息生成最终答案，包含引用出处
4. **迭代深入**：在预算限制内进行多轮搜索-阅读-推理循环，直到找到满意答案

## 上下文管理

* **行动追踪**：记录每个步骤的行动，构建上下文记忆
* **动态决策**：基于已收集的信息和剩余预算决定下一步行动
* **URL排序和去重**：智能管理已访问的URL，避免重复访问和无效内容
* **引用管理**：跟踪信息来源，生成带有引用的最终答案

## 工具使用

* **搜索引擎集成**：支持多种搜索引擎，包括Jina Reader、DuckDuckGo、Brave等
* **代码沙箱**：可执行代码进行计算或数据处理
* **查询优化工具**：使用查询重写器优化搜索关键词
* **错误分析工具**：分析步骤中的错误并进行调整
* **Token预算管理**：跟踪API调用的token消耗，确保控制成本

## 执行效果

* **深度研究能力**：能处理复杂问题，通过多步骤搜索提供详细答案
* **引用来源**：提供信息来源，增强答案可信度
* **交互式推理**：展示思考过程，让用户了解答案的得出过程
* **支持多种问题类型**：从简单事实查询到复杂的分析性问题

## 成本控制

* **Token预算管理**：设置总token消耗预算，避免过度消耗
* **URL访问限制**：限制每步骤可访问的URL数量，优化资源使用
* **智能搜索策略**：避免重复的搜索请求，优先使用更有可能提供有用信息的URL
* **缓存机制**：缓存已获取的内容，避免重复网络请求

## 其他特性

* **思考过程可视化**：使用 `<think>...</think>` 标记显示推理过程
* **多模型支持**：支持多种LLM，包括Gemini、OpenAI模型，以及本地LLM
* **OpenAI兼容API**：提供与OpenAI API兼容的接口，易于集成
* **引用格式化**：使用标准的Markdown脚注格式提供引用
* **错误处理和恢复**：具有鲁棒的错误处理机制，能够从失败中恢复