# Deep Searcher 项目分析

## 项目结构和框架

* **编程语言和框架**：Deep Searcher 使用 Python 作为主要编程语言，以及 FastAPI 作为其 Web 服务框架。项目结构清晰，采用模块化设计，便于扩展和维护。
* **代码目录结构**：
  * `deepsearcher/`: 核心代码目录
    * `agent/`: 包含不同 RAG 代理实现，如 naive_rag、chain_of_rag、deep_search 等
    * `embedding/`: 嵌入模型接口和实现，支持多种嵌入模型
    * `llm/`: 大语言模型接口和实现，支持多种 LLM 提供商
    * `vector_db/`: 向量数据库接口和实现，如 Milvus、Qdrant
    * `loader/`: 文档加载器，支持本地文件和网站内容加载
    * `utils/`: 通用工具函数
  * `examples/`: 示例代码
  * `tests/`: 测试代码
  * `evaluation/`: 评估工具

## 交互方式

* **API 接口**：通过 FastAPI 提供 REST API 接口，包括配置设置、文档加载、查询等功能
* **Python 库**：可作为 Python 库导入使用，提供丰富的 API 函数
* **命令行工具**：通过 CLI 支持命令行操作
* **Web 界面**：项目演示中展示了一个简单的 Web 界面，可视化展示搜索和问答结果

## 基本流程

1. **配置初始化**：用户首先配置 LLM 和嵌入模型，选择向量数据库
2. **数据加载**：支持从本地文件或网站加载内容，解析并分块存入向量数据库
3. **查询处理**：
   * 用户输入查询
   * 系统将查询分解为子查询
   * 将查询向量化并在向量数据库中搜索相关内容
   * 对检索结果进行重排序和筛选
   * 使用 LLM 基于检索结果生成最终回答
4. **迭代优化**：支持反思过程，生成补充查询以获取更全面的信息

## 上下文管理

* **查询分解**：将复杂查询分解为子查询，以便更全面地检索相关信息
* **迭代检索**：通过 `max_iter` 参数控制迭代次数，在初始检索后进行反思并生成补充查询
* **集合路由**：使用 `CollectionRouter` 决定在哪些集合中进行搜索，优化检索效率
* **结果去重和过滤**：通过相似度计算和 LLM 评估去除冗余和不相关内容

## 工具使用

* **多模型支持**：支持多种 LLM（OpenAI、DeepSeek、Claude、Grok、Llama 4 等）和嵌入模型
* **多向量数据库**：支持 Milvus、Qdrant 等向量数据库
* **Web 爬虫**：支持从网站加载内容，集成 FireCrawl 进行网页爬取
* **灵活的配置系统**：通过配置文件或 API 支持动态配置模型和参数

## 执行效果

* **高质量回答**：利用 RAG（检索增强生成）技术提供基于私有数据的精确回答
* **全面信息收集**：通过查询分解和迭代检索策略，确保获取全面的相关信息
* **定制化报告生成**：支持根据检索到的信息生成结构化报告
* **灵活处理不同类型的查询**：从简单的单点问题到复杂的深度研究任务

## 成本控制

* **模型选择灵活性**：支持从高性能但成本较高的模型（如 OpenAI o1）到本地部署的开源模型（如 Ollama）的灵活切换
* **检索优化**：通过集合路由、结果筛选减少不必要的 LLM API 调用
* **批处理机制**：支持批量处理嵌入和文档加载，提高资源利用效率
* **迭代次数控制**：通过 `max_iter` 参数限制反思和补充查询的次数，平衡质量和成本

## 其他特性

* **多代理架构**：实现了多种 RAG 代理（NaiveRAG、DeepSearch、ChainOfRAG）以适应不同场景
* **多语言支持**：支持不同语言的文档处理和查询
* **开源可扩展**：采用 Apache 2.0 许可，便于社区贡献和扩展
* **丰富的配置选项**：支持自定义几乎所有组件的行为和参数
* **可视化评估**：包含评估工具，用于测试和比较不同配置的性能